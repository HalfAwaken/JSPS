<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>内部销售增加</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="css/font.css">
		<link rel="stylesheet" href="css/xadmin.css">
		<link rel="stylesheet" href="https://cdn.bootcss.com/Swiper/3.4.2/css/swiper.min.css">
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="https://cdn.bootcss.com/Swiper/3.4.2/js/swiper.jquery.min.js"></script>
		<script src="lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="js/xadmin.js"></script>

	</head>

	<body>
		<!-- 中部开始 -->
		<div class="wrapper">
			<!-- 右侧主体开始 -->
			<div class="page-content">
				<div class="content" style="min-height: 0;">
					<!-- 右侧内容框架，更改从这里开始 -->
					<form class="layui-form">
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品分类
                    </label>
							<div class="layui-input-inline">
								<select class="category" name="category" lay-filter="category">
									
								</select>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品名字
                    </label>
							<div class="layui-input-inline">
								<input type="text" class="layui-input proname">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品图片
                    </label>
							<div class="layui-input-inline" style="position: relative;">
								<input type="file" name="imgFile" id="loadImgs" class="layui-input proimg" style="width: 100px;height: 100px;opacity: 0;" accept="image/*">
								<img class="choiceImg" src="images/chooseImage.png" style="width: 100px;height: 100px;position: absolute;top: 0;left: 0;"/>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品规格
                    </label>
							<div class="layui-input-inline">
								<select class="proSpec" name="proSpec" lay-filter="proSpec">
									<option value="立方">立方</option>
									<option value="袋">袋</option>
									<option value="件">件</option>
								</select>
							</div>
						</div>
						<div class="layui-form-item bag" style="display: none;">
							<label class="layui-form-label">
                        <span class="x-red">*</span>详细规格
                    </label>
							<div class="layui-input-inline">
								<input type="number" class="layui-input promsgspec" />
							</div>
							<div class="layui-form-mid layui-word-aux">
								<span class="x-red"></span>袋=1立方
							</div>
						</div>
						<div class="layui-form-item piece" style="display: none;">
							<label class="layui-form-label">
                        <span class="x-red">*</span>详细规格
                    </label>
							<div class="layui-input-inline">
								<input type="number" class="layui-input promsgspec" />
							</div>
							<div class="layui-form-mid layui-word-aux">
								<span class="x-red"></span>件=1立方
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品价格
                    </label>
							
							<div class="layui-input-inline">
								<input type="number" class="layui-input proprice" />
							</div>
							<div class="layui-form-mid layui-word-aux">
								<span class="x-red"></span>元
							</div>
							
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>商品库存
                    </label>
							
							<div class="layui-input-inline">
								<input type="number" class="layui-input prostock" />
							</div>
							
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>是否上架
                    </label>
							<div class="layui-input-inline">
								<select class="online" name="online" lay-filter="online">
									<option value="1">上架</option>
									<option value="0">下架</option>
								</select>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>排序号
                    </label>
							
							<div class="layui-input-inline">
								<input type="number" class="layui-input proNum" />
							</div>
							
						</div>
						<div class="layui-form-item" style="font-size: 24px;">搬运设置</div>
						<div class="layui-form-item" style="display: flex;padding-left: 140px;">
							<div style="width: 190px;">楼梯</div>
							<div style="width: 190px;margin-left: 20px;">电梯</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>搬运价格/层
                    </label>
							<div class="layui-input-inline" style="display: flex;width: 400px;">
								<input type="number" placeholder="请输入楼梯搬运价格" data-type="stairs" name="layerlt" class="layui-input surepassword layer layerone">
								<input type="number" placeholder="请输入电梯搬运价格" data-type="elevator" name="layerdt" style="margin-left: 20px;" class="layui-input surepassword layer layertwo">
							</div>
							<div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
								元
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>搬运起送价
                    </label>
							<div class="layui-input-inline" style="width: 200px;display: flex;">
								<input type="number" placeholder="请输入搬运起送价" data-type="stairs" style="width: 190px;" name="secondlt" class="layui-input surepassword startmoney">
								<!--<input type="number" disabled placeholder="请输入电梯转运价格" data-type="elevator" name="seconddt" class="layui-input surepassword seconds secondstwo" style="opacity: 0;margin-left: 20px;">-->
							</div>
							<div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
								元
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>卸货价格/米
                    </label>
							<div class="layui-input-inline" style="width: 400px;display: flex;">
								<input type="number" placeholder="请输入楼梯卸货价格" data-type="stairs" name="ricelt" class="layui-input surepassword rice riceone">
								<input type="number" placeholder="请输入电梯卸货价格" data-type="elevator" name="ricedt" class="layui-input surepassword rice ricetwo" style="margin-left: 20px;">
							</div>
							<div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
								元
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                        <span class="x-red">*</span>转运价格/次
                    </label>
							<div class="layui-input-inline" style="width: 200px;display: flex;">
								<input type="number" placeholder="请输入转运价格" data-type="stairs" style="width: 190px;" name="secondlt" class="layui-input surepassword seconds secondsone">
								<!--<input type="number" disabled placeholder="请输入电梯转运价格" data-type="elevator" name="seconddt" class="layui-input surepassword seconds secondstwo" style="opacity: 0;margin-left: 20px;">-->
							</div>
							<div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
								元
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                    </label>
							<div class="layui-btn addPro">
								修改
							</div>
						</div>
					</form>
					<!-- 右侧内容框架，更改从这里结束 -->
				</div>
			</div>
			<!-- 右侧主体结束 -->
		</div>
		<!-- 中部结束 -->

	</body>
	<script>
		$(function() {
			layui.use('upload',function(){
				console.log(layui)
				var upload = layui.upload;
				upload.render({
					elem:"#loadImgs",
					url:'http://192.168.0.102:9001/order/uploadImg',
					multiple: true,
					before: function (obj) {
		                obj.preview(function(index, file, result){
		                	console.log(index,file)
						$('#demo1preview').attr('src', result); //图片链接（base64）
					  });
		            },
					done:function(res){
						console.log(res)
						$('.choiceImg').attr("src",res.data)
					}
				})
			})
			var obj = {};
			var dataList = sessionStorage.getItem('productItem');
			dataList = JSON.parse(dataList);
			obj = dataList;
			$('.proname').val(dataList.goodname);
			$('.choiceImg').attr('src',dataList.goodimg);
			$('.proprice').val(dataList.price);
			$('.prostock').val(dataList.goodcount);
			$('.online').val(dataList.isonline);
			$('.proNum').val(dataList.goodorder);
			$('.layerone').val(dataList.carrystairs);
			$('.layertwo').val(dataList.carryelevator);
			$('.riceone').val(dataList.unloadstatirs);
			$('.ricetwo').val(dataList.unloadelevator);
			$('.secondsone').val(dataList.turns);
			$('.startmoney').val(dataList.startmoney)
			var goodSpecL = '立方';
//			obj.gooditem='沙子';
//			obj.goodname='测试商品';
			obj.goodimg='https://dss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2210930787,594353927&fm=26&gp=0.jpg';
//			obj.goodspe='立方';
//			obj.goodcount=100;
//			obj.price=99;
			obj.isonline=1;
			$('.addPro').click(function(){
				console.log(obj)
				let newObj = {};
				newObj.id = obj.id;
				newObj.gooditem = obj.gooditem;
				newObj.goodname = obj.goodname;
				newObj.goodimg = $('.choiceImg').attr("src");
				newObj.goodspe = obj.goodspe;
				newObj.goodcount = obj.goodcount;
				newObj.price = obj.price;
				newObj.isonline = obj.isonline;
				newObj.goodorder = obj.goodorder;
				newObj.carrystairs = obj.carrystairs;
				newObj.carryelevator = obj.carryelevator;
				newObj.unloadstatirs = obj.unloadstatirs;
				newObj.unloadelevator = obj.unloadelevator;
				newObj.turns = obj.turns;
				newObj.startmoney = obj.startmoney;
				$.ajax({
					type:"post",
					url:"http://192.168.0.102:9001/goods/updateGoods",
					data:newObj
				}).then(res=>{
					console.log(res)
					if(res.code==0){
						layui.layer.msg('修改成功');
						setTimeout(function(){
							var index = parent.layer.getFrameIndex(window.name);
							parent.location.reload();
							parent.layer.close(index);
						},1500)
					}else{
						layui.layer.msg('修改失败，请联系管理员或重试');
					}
				})
			})
			$.ajax({
				type:"get",
				url:"http://192.168.0.102:9001/goodsItem/findAll"
			}).then(res=>{
				console.log(res)
				var datas = res.data;
				if(datas.length>0){
					var str = '';
					datas.forEach((cur,index)=>{
						str += '<option value="'+cur.id+'">'+cur.itemname+'</option>'
					})
					$('.category').html(str)
				}
				layui.use('form',function(){
					var form = layui.form;
					form.on('select(category)',function(data){
						console.log(data)
						obj.gooditem = data.value;
					})
					$('.category').val(dataList.gooditem)
				})
			})
			$('.layer').on('input', function(e) {
				if(e.currentTarget.dataset.type == 'stairs') {
					obj.carrystairs = e.target.value;
				} else {
					obj.carryelevator = e.target.value;
				}
			})
			$('.rice').on('input', function(e) {
				if(e.currentTarget.dataset.type == 'stairs') {
					obj.unloadstatirs = e.target.value;
				} else {
					obj.unloadelevator = e.target.value;
				}
			})
			$('.startmoney').on('input',function(e){
				obj.startmoney = e.target.value;
			})
			$('.seconds').on('input', function(e) {
				obj.turns = e.target.value
			})
			$('.proname').on('input',function(e){
				obj.goodname = e.target.value;
			})
			$('.proprice').on('input',function(e){
				obj.price = Number(e.target.value);
			})
			$('.prostock').on('input',function(e){
				obj.goodcount = Number(e.target.value);
			})
			$('.proNum').on('input',function(e){
				obj.goodorder = Number(e.target.value);
			})
			$('.choiceImg').click(function(){
				$(this).siblings('input').click()
			})
			$('form').off('input','.bag input').on('input','.bag',function(e){
				console.log(e)
				obj.goodspe = e.target.value+goodSpecL+'/立方';
			})
			$('form').off('input','.piece input').on('input','.piece',function(e){
				obj.goodspe = e.target.value+goodSpecL+'/立方';
			})
			layui.use('form',function(){
				var form = layui.form;
				form.on('select(category)',function(data){
					console.log(data)
					obj.gooditem = data.value;
				})
				form.on('select(proSpec)',function(data){
					if(data.value=='袋'){
						$('.bag').show();
						$('.piece').hide();
						goodSpecL = data.value;
					}else if(data.value=='件'){
						$('.bag').hide();
						$('.piece').show();
						goodSpecL = data.value;
					}else{
						$('.bag').hide();
						$('.piece').hide();
						obj.goodspe = data.value;
					}
					
				})
				form.on('select(online)',function(data){
					obj.isonline = Number(data.value);
				})
				if(dataList.goodspe.indexOf('袋')!=-1){
					$('.bag').show();
					$('.piece').hide();
					goodSpecL = '袋';
					$('.proSpec').val('袋');
					$('.bag input').val(dataList.goodspe.substring(0,dataList.goodspe.indexOf('袋')))
				}else if(dataList.goodspe.indexOf('件')!=-1){
					$('.bag').hide();
					$('.piece').show();
					goodSpecL = '件';
					$('.proSpec').val('件')
					$('.piece input').val(dataList.goodspe.substring(0,dataList.goodspe.indexOf('件')))
				}else{
					$('.bag').hide();
					$('.piece').hide();
					obj.goodspe = '立方';
					$('.proSpec').val('立方')
				}
			})
		})
	</script>

</html>